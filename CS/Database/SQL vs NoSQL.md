# SQL vs NoSQL
* [SQL: 관계형 데이터베이스](#sql-관계형-데이터베이스)
* [NoSQL: 비관계형 데이터베이스](#nosql-비관계형-데이터베이스)
* [수직적(Vertical) & 수평적(Horizontal) 확장](#수직적vertical--수평적horizontal-확장)
* [정리](#정리)

# SQL: 관계형 데이터베이스
* SQL은 *구조화된 쿼리 언어*의 약자이다.  
* SQL을 사용하면 관계형 데이터베이스 관리 시스템(RDBMS)에서 데이터를 저장, 수정, 삭제 및 검색할 수 있다.  
* 관계형 데이터베이스는 두 가지 주요 특징이 있다.  
  * 데이터는 **정해진(엄격한) 데이터 스키마에 따라** 데이터베이스 테이블에 저장된다.
  * 데이터는 **관계**를 통해서 연결된 **여러개의 테이블에 분산**된다.

## 1. 엄격한 스키마
* 데이터는 테이블(table)에 레코드(row)로 저장된다.
* 각 테이블에는 명확하게 정의된 구조(structure)가 있다.  
  * 구조: 이름과 데이터 유형으로 정의된 field(column)의 집합  

<img src="https://t1.daumcdn.net/cfile/tistory/99BF063C5C937DF324" width="700" height="350">

따라서 ***스키마를 준수하지 않은 레코드는 테이블에 추가할 수 없다.***  
> 예를 들어, 위 테이블에서 '유통 기한'이라는 필드(컬럼)을 넣고 싶다면, 스키마를 수정하지 않는 한 필드를 추가할 수 없다는 것이다.  
> 즉, 스키마를 수정하지 않는 이상 정해진 구조에 맞는 레코드만 추가가 가능하다.  
> `스키마`: 데이터베이스의 구조(개체, 속성, 관계)와 제약 조건에 대한 정의이다. 메타 데이터라고도 한다.

## 2. 관계
* 각각의 테이블은 다른 테이블과 중복되지 않는 데이터를 갖고 있다.
* 따라서, 하나의 테이블에서 중복없이 하나의 데이터만을 관리하기 때문에, 다른 테이블에서 부정확한 데이터를 다룰 위험이 없다. 
* 각 테이블에서 연관관계를 통해 다른 테이블의 데이터를 가져와 사용할 수 있다.  

<img src="https://t1.daumcdn.net/cfile/tistory/994D09355C937ECD2D" width="700" height="300">

> 위의 예시에서는, 사용자가 구입한 상품들을 나타내기 위해 데이터들을 `Users`, `Products`, `Orders` 테이블로 나눠 저장했다.  
> 따라서 각각의 테이블에서 중복없이 하나의 데이터만을 관리하므로 다른 테이블에서 부정확한 데이터를 다룰 위험이 없다.  

# NoSQL: 비관계형 데이터베이스
* 관계형 데이터베이스(SQL)의 반대이다.  
* 스키마와 관계가 없다.
* NoSQL에서는 레코드(record)를 문서(documents)라고 부른다.  
* SQL에서는 정해진 스키마를 따르지 않는다면 데이터를 추가할 수 없지만, NoSQL에서는 다른 구조의 데이터를 같은 컬렉션(=SQL에서의 테이블)에 추가할 수 있다.

<img src="https://t1.daumcdn.net/cfile/tistory/99FBC9415C937F2A20" width="700" height="300">

문서(documents)는 JSON 데이터와 비슷한 형태를 갖고 있다.  
또한, 일반적으로 관련 데이터를 동일한 컬렉션에 넣는다. 관계형 데이터베이스처럼 여러 테이블에 나누어 담지 않는다.
> 관계형 데이터베이스에서는 사용자가 구입한 상품들을 나타내기 위해 `Users`, `Products`, `Orders`에 데이터를 나눠 저장했지만,  
> 비관계형 데이터베이스에서는 모든 데이터를 `Orders` 컬렉션에 저장해 관리한다.  

따라서 여러 테이블(컬렉션)에 조인(join)할 필요없이 이미 필요한 모든 데이터를 갖춘 문서를 작성하게 된다.  
NoSQL 데이터베이스는 조인(join)이라는 개념이 존재하지 않는다.


## NoSQL에서 조인을 사용하고 싶은 경우
컬렉션을 통해 데이터를 복제하여 각 컬렉션 일부분에 속하는 데이터를 산출해 사용한다.  

<img src="https://t1.daumcdn.net/cfile/tistory/99C57D3B5C937F5E17" width="650" height="320">

* **단점**
  * 이런 방식은 데이터의 일관성이 깨질 수 있다.   
  > 컬렉션 Users에서는 데이터를 수정하지 않았는데, 컬렉션 Orders에서만 데이터를 업데이트 하는 등 일관성이 깨질 수 있다.   
  > 따라서,하나의 컬렉션에서 데이터를 업데이트하는 경우, 해당 데이터를 같이 사용하는 모든 컬렉션에서 똑같은 데이터 업데이트를 수행해야한다.   
* **장점**
  * 필요한 모든 데이터가 이미 하나의 컬렉션 안에 저장되어 있으므로, `복잡하고 느린 조인(join)` 을 사용할 필요가 없다는 것이다.  
  * 특히 NoSQL은 자주 변경되지 않는 데이터를 저장할 때 더 효율적이다.
  > 컬렉션을 통해 데이터 일부를 복제해도 변경이 자주 일어나지 않으므로, 일관성을 맞춰줄 필요 없음   
  > 따라서, 자주 변경되지 않는 데이터 경우 필요한 모든 데이터가 이미 하나의 컬렉션 안에 저장되어 join이 필요없는 NoSQL이 효율적

> Q. NoSQL에서 조인이 필요한 경우가 뭐 있지? 어차피 하나의 컬렉션에 모든 데이터가 다 저장되어 있는데 그냥 꺼내쓰면 되는거 아닌가?  
>    굳이 컬렉션의 일부 데이터를 복제해 새 컬렉션을 만들어 사용하지? 일관성 유지비용이 더 드는데?


# 수직적(Vertical) & 수평적(Horizontal) 확장
* 두 종류의 데이터베이스를 비교할 때 중요한 개념으로는 확장(Scaling)이 있다. -> 데이터베이스의 서버의 확장성
* 확장은 `수직적(verticla) 확장`과 `수평적(horizontal) 확장`이 있다.    
  * `수직적 확장(스케일 업)`: 단순히 데이터베이스 서버의 성능을 향상시키는 것 (예를 들어, CPU를 업그레이드 하는 방식)
  * `수평적 확장(스케일 아웃)`: 더 많은 서버가 추가되고, 데이터베이스가 전체적으로 분산된다. 따라서 하나의 데이터베이스에서 작동하지만, 여러 호스트에서 작동한다.

<img src="https://t1.daumcdn.net/cfile/tistory/990D6E385C937F8530" width="650" height="300">

* SQL 관계형 데이터베이스는 일반적으로 수직적 확장을 지원한다.
  * 근데 요즘은 스케일 업, 스케일 아웃 다 되는듯 합니다. 공부 후 추가하기
* NoSQL 비관계형 데이터베이스에서만 수평적 확장이 가능하다.

# 정리
### SQL 장점
* 명확하게 정의된 스키마에 따라 데이터 무결성 보장
* 관계를 통해 데이터를 중복없이 한 번만 저장한다.
### NoSQL 장점
* 스키마가 없거나 느슨하기 때문에 훨씬 유연하다. 즉, 새로운 필드를 추가할 수 있다.
* `key-value`, `Document` 등 다양한 구조로 저장
* 복잡하고 느린 join을 사용하지 않으므로 데이터를 읽어오는 속도 향상
* 수직 및 수평 확장이 모두 가능하므로, 읽기/쓰기 성능 향상
### SQL 단점
* 상대적으로 덜 유연하다. 기존의 스키마는 수정하기 어렵다.
* join문이 많은 매우 복잡한 쿼리로 인해 성능이 저하될 수 있다.
* 수평적 확장이 어려워 처리량에 한계가 있다.
### NoSQL 단점
* 유연성 때문에, 데이터 구조 결정을 하지 못하고 미루게 될 수 있다.
* 여러 컬렉션에 데이터가 중복되어 있는 경우 일관성 유지를 해줘야 한다.
  * SQL에서는 각 테이블에 중복된 데이터가 없기 때문에 update발생 시 한번만 수행하면 됨
### SQL 언제 사용하는 것이 좋을까?
* 관계를 맺고 있는 데이터가 자주 변경(update)되는 애플리케이션일 경우
* 명확한 스키마가 사용자와 데이터에게 중요한 경우 
* 관계형 데이터베이스: `Oracle`, `MySQL`
### NoSQL 언제 사용하는 것이 좋을까?
* 정확한 데이터 구조를 알 수 없거나 변경/확장 될 수 있는 경우
* 읽기(read)처리는 자주하지만, 수정(update)처리는 자주 하지 않는 경우
* 데이터베이스를 수평으로 확장해야되는 경우 즉, 막대한 양의 데이터를 다뤄야 하는 경우
* 비관계형 데이터베이스
  * Key-value: `Redis`
  * 문서형(JSON, XML): `MongoDB`


























