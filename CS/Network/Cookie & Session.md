# Cookie & Session

### HTTP의 특징 
* `Connectionless: 비 연결지향` 
  * 클라이언트에서 서버에 요청을 보내면 서버는 클라이언트에 응답을 하고 접속을 끊는다. 
* `Stateless: 상태정보 유지 안함`
  * 연결을 끊는 순간 클라이언트와 서버의 통신은 끝나며 상태 정보를 유지하지 않는다.

계속해서 연결을 유지하지 않기 때문에 리소스 낭비가 줄어드는 것이 큰 장점이지만,  
통신할 때마다 새로 연결하기 때문에 클라이언트는 매 요청마다 인증을 해야 한다는 단점이 있다.


따라서, HTTP 프로토콜에서 상태를 유지하기 위해 **쿠키**와 **세션**이라는 방법이 존재한다.

# Cookie: 쿠키
* 쿠키는 클라이언트 로컬에 저장되는 `key-value` 쌍의 작은 데이터 파일이다.  
* 쿠키 사용 예: 아이디/비밀번호 저장, 쇼핑몰 장바구니 등
### 동작 방식
<img src="https://miro.medium.com/max/1400/1*fWfKsO9P2rReNzJM2doBhQ.png" width="500" height="350">

1. 클라이언트가 서버에 로그인을 요청한다.
2. 서버는 클라이언트의 로그인 요청의 유효성을 확인(아이디와 비밀번호 검사) 후 상태를 유지하고 싶은 값을 쿠키(cookie)로 생성
3. 서버가 응답할 때, HTTP `응답헤더`에 쿠키를 추가하여 응답
```http
set-cookie: user=haneul
```
4. 클라이언트는 전달 받은 쿠키를 웹브라우저에서 관리하고 있다가, 다음 요청 때 쿠키를 HTTP 헤더에 넣어서 전송
```http
cookie: user=haneul
```
5. 서버에서는 쿠키 정보를 읽어 이전 상태 정보를 확인한 후 응답

# Session: 세션
* 브라우저가 종료되기 전까지 클라이언트의 요청을 유지하게 해주는 기술이다.
* 세션 사용 예: 로그인

<img src="https://miro.medium.com/max/1400/1*oiHghHg3sQW5ynmMCAtPAA.png" width="500" height="350">

1. 클라이언트가 서버에 로그인 요청을 한다.
2. 서버는 해당 웹브라우저(클라이언트)에 유일한 ID(Session ID)를 부여한다.
3. 서버가 응답할 때 HTTP 헤더(Set-Cookie)에 Session ID를 포함해 전송한다.
```http
set-cookie: sessionid:a1x2fjz
```
4. 웹 브라우저는 웹브러우저가 종료되기 전까지 서버에 요청 시 Session ID가 담겨있는 쿠키를 HTTP 헤더에 넣어서 전송
```http
Cookie: sessionid:a1x2fjz
```
5. 서버는 세션 ID를 확인하고, 해당 세션에 관련된 정보를 확인한 후 응답

> 세션도 쿠키를 사용하여 값을 주고받으며, 클라이언트의 상태 정보를 유지한다.  
> 즉, 상태 정보를 유지하는 수단은 `쿠키`이다.

# 쿠키와 세션의 차이점
* 저장 위치
  * 쿠키: 클라이언트
  * 세션: 서버
* 보안
  * 쿠키: 클라이언트에 저장되므로 보안에 취약하다.
  * 세션: 쿠키를 이용해 Session ID만 저장하고, 이 값으로 구분해서 서버에서 처리하므로 비교적 보안성이 좋다.
* 라이프사이클
  * 쿠키: 만료시간에 따라 브라우저를 종료해도 계속해서 남아있을 수 있다.
  * 세션: 만료시간을 정할 수 있지만, 브라우저가 종료되면 만료시간에 상관없이 삭제된다.
* 속도
  * 쿠키: 클라이언트에 저장되어서 서버에 요청 시 빠르다.
  * 세션: 실제 저장된 정보가 서버에 있으므로 서버의 처리가 필요해 쿠키보다 느리다.
