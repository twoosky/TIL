# 프로세스, 스레드

## 프로세스(Process)
`프로세스`란 메모리에 적재되고 CPU 자원을 할당받아 프로그램이 실행되고 있는 상태이다.  
* CPU를 점유하고 있어야 한다.
* 하나의 프로세스 안에 여러개의 스레드 생성 가능
* 프로세스마다 최소 1개의 스레드(Main Thread)를 소유
* 프로세스간의 통신은 IPC (InterProcessComunicaiton)
> 프로그램: 어떤 작업을 하기 위해 실행할 수 있는 파일  
> 즉, 프로그램은 메모리에 저장된 정적인 상태, 프로세스는 실행을 위해 메모리에 적재된 동적인 상태  
> 적재(load): 메모리에 있는 데이터를 레지스터로 가져오는 명령   
> 저장(store): 레지스터에 있는 데이터를 메모리에 저장하는 명령

## 프로세스 메모리 영역
* `Code`: 실행될 코드가 기계어 형태로 저장된 공간
* `Data`: 전역변수, static변수 등이 저장된 공간
* `Heap`: 동적할당을 위한 메모리 영역(malloc(), new 등)
* `Stack`: 지역 변수, 반환값, 파라미터(함수에 전달되는 인자) 등을 저장하는 공간
> Code, Data 영역은 선언할 때 크기가 결정되는 정적 영역   
> Stack, Heap 영역은 프로세스가 실행되는 동안 크기가 변할 수 있는 동적 영역

## 프로세스 생명주기
<img src="https://user-images.githubusercontent.com/57896918/158165830-203bc68d-a277-4e36-bc22-b3d2a571271e.png" width="600" height="250">

* **New(생성)**
  * 프로세스가 생성된 상태
* **Ready(준비)**
  * CPU 점유 대기 상태
  * PCB는 ready queue에서 기다리며 CPU 스케줄러에 의해 관리
* **Running(실행)**
  * CPU를 점유하여 실행되고 있는 상태
  * interrupt가 발생하면 실행 중이던 프로세스는 read 상태로 변한다.
  * 실행을 끝마치면 exit(종료)되고 terminated 상태로 변한다.
  * I/O(입출력)이나 event가 발생하면 waiting 상태로 변한다.
* **waiting(대기)**
  * I/O(입출력)이 발생하면 완료될 때까지 대기한다.
  * event가 완료되기를 대기한다.
  * 작업이 모두 끝나면 다시 Ready 상태가 된다.
* **Terminated(종료)**
  * 프로세스가 실행을 끝마친 상태

## 스레드(Thread)
스레드란 프로세스 내에서 실행되는 흐름의 단위 혹은 CPU 스케줄링의 기본 단위이다.  
* 모든 프로세스는 최소 한개 이상의 스레드를 갖는다.
* 스레드는 프로세스 내에서 **Code, Data, Heap** 영역을 공유한다.
* 스레드는 각자 자신의 **Stack** 영역을 보유한다. (최소한 자신의 레지스터 상태를 보유한다.)
* 스레드 Context Switching은 Stack만 교체하면 되므로 프로세스보다 빠르다.

## 멀티 프로세스(Multi Process)
한 개의 프로그램을 여러개의 프로세스를 구성하여 병렬적인 작업을 실행 하는 것
* 각각의 프로세스는 독립적이기 때문에, 한개의 프로세스에서 일어난 문제점이 다른 프로세스로 전이되지 않는다.
* Context Switching시 오버헤드가 크다.
  * 각각의 프로세스는 독립된 메모리 영역(stack, heap, code, data)을 갖고있으므로  
    Context Switching 시 캐시에 존재하는 모든 데이터를 리셋하고 다시 캐시 정보를 불러와야 한다. 
* 프로세스간의 통신에 복잡한 IPC를 사용하여 통신해야 한다. (비용이 상대적으로 크다)

## 멀티 스레드(Multi Thread)
하나의 프로세스에서 여러 스레드로 자원을 공유하며 작업을 나눠 수행하는 것이다. 
* 응답성이 향상된다.
  * 하나의 스레드만 사용하면 하나의 연산에 block되지만 여러 스레드를 사용하면 하나가 오래걸려도 blcok되지 않아 응답성이 향상된다.
* 시스템 자원 소모가 감소한다. 프로세스를 생성하는 system call이 줄어들어 자원을 효율적으로 관리할 수 있다.
* 프로세스 내의 Data, Code, Heap 영역을 공유하기 때문에 쓰레드 간의 통신이 간단하다. 
* 쓰레드 간의 자원을 공유하기 때문에 동기화 문제(Synchronize problem)가 발생할 수 있다.
* 디버깅이 까다롭다.
* 하나의 쓰레드에 문제가 발생하면 전체 프로세스에 영향을 준다.
