# 세마포어, 뮤텍스
세마포어와 뮤텍스는 **여러 프로세스나 스레드가 공유 자원에 동시에 접근하는 것을 제어하기 위한 방법**이다.  
즉, 병행 처리를 위한 프로세스 동기화 기법이다.  
교착상태 조건 중 상호배제 조건을 해결하기 위한 방법이다.

# 임계 구역(Critical Section)
멀티 프로세스(멀티 스레드) 환경에서 둘 이상의 프로세스가 동시에 접근해서는 안되는 공유 자원의 코드 영역이다. 
공유 자원에 여러 프로세스가 동시에 접근하는 경우 잘못된 결과를 만들 수 있으므로,   
한 프로세스가 임계 구역을 수행할 때는 다른 프로세스가 접근하지 못하도록 해야 한다.

# 세마포어(Semaphore)
멀티프로그래밍/스레딩 환경에서 공유자원에 대한 접근을 wait/signal 방식으로 제한하며,  
Lock을 걸지 않은 스레드가 signal을 보내 Lock을 해제 할 수 있는 방식

## 세마포어 작동 방식
* `P(wait)`
  * 임계 구역 들어가기 전에 수행
  * 세마포어 값을 감소시킨다. 
  * 세마포어 값이 0보다 작으면 기다린다(wait). 
  * 세마포어 값이 0보다 크거나 같으면 리턴한다. 따라서 프로세스는 임계 구역에 진입할 수 있다.
* `V(signal)`
  * 임계 구역에서 나올 때 수행 
  * 세마포어 값을 증가시킨다.
  * 대기 중인 프로세스를 깨운다.

```
P(S);

// --- 임계 구역 ---

V(S);
```
```bash
procedure P(S)  
    S := S-1  --> s값 감소
    while S>0 do wait  --> S 값이 0보다 작으면 기다려야 함(wait)
end P

--- 임계 구역 ---

procedure V(S)
    S := S+1   --> S값 증가
end V
```

# 뮤텍스
임계 구역을 가진 스레드들의 실행시간이 서로 겹치지 않고 각각 단독으로 실행되게 하는 기술이다.  
상호배제(Mutual Exclusion)의 약자로, 임계 구역의 접근을 제한하기 위해 lock과 unlock을 사용한다.  
뮤텍스는 상태가 0, 1로 이진 세마포어로 부르기도 한다.  

## 뮤텍스 작동 방식
* `lock`
  * 현재 임계 구역에 들어갈 수 있는 권한을 얻음.
  * 만약 다른 프로세스/스레드가 lock을 잡고 있다면 lock을 놓아줄 때까지 대기
* `unlock`
  * 임계 구역을 모두 수행한 후 호출
  * unlock을 호출하면 lock을 기다리던 다른 프로세스/스레드들이 lock을 잡을 수 있다.  

```c
mutex = 1;

void lock () {
    while (mutex == 1) {
    	  // 다른 프로세스/스레드가 lcok을 잡고있는 상태이므로 mutex값이 0이 될 때까지 대기
    }
    // mutex값이 0인 경우 즉, 아무도 lock을 잡고 있지 않으므로 임계 구역 진입 가능 상태
    // mutex값을 1로 바꾼다(lock을 잡음)
    mutex = 1;
}

void unlock() {
    // 임계 구역에서 나온 프로세스는 다른 프로세스가 접근할 수 있도록 락을 해제한다.
    mutex = 0;
}
```

# 뮤텍스와 세마포어 차이
* 세마포어는 **세마포어의 변수 개수만큼의 프로세스 또는 스레드가 공유자원에 접근**할 수 있다.
* 반면에 뮤텍스는 **오직 1개의 프로세스 또는 스레드만 공유자원에 접근**할 수 있다.
* 세마포어는 현재 수행 중인 프로세스가 아닌 **다른 프로세스가 세마포어를 해제**할 수 있다.
* 반면에 뮤텍스는 **lock을 획득한 프로세스가 반드시 그 lock을 해제**해야 한다.
