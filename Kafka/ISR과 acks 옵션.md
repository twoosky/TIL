# ISR(In-Sync-Replicas)와 acks 옵션
* `ISR`: 리더 파티션과 팔로워 파티션이 모두 싱크가 된 상태를 의미한다.
* 리더 파티션과 팔로워 파티션의 오프셋이 동일할 때 싱크가 된 상태라고 한다.
* 리더 파티션에 레코드가 추가되어 오프셋이 증가하면, 팔로워 파티션이 위치한 브로커는 해당 레코드를 복제한다.
* 리더 파티션에 데이터가 적재된 이후 팔로워 파티션이 복제하는 시간차 때문에 리더 파티션과 팔로워 파티션 간의 오프셋 차이가 발생한다.
<br></br>
* ex) 복제 개수가 2인 토픽에는 리더 파티션 1개와 팔로워 파티션 1개가 존재할 것이다.
* 리더 파티션에 0부터 3의 오프셋이 있다고 할 때 팔로워 파티션에도 0부터 3까지의 오프셋이 존재해야한다.
* 동기화가 완료되었다는 의미는 아래 그림과 같이 리더 파티션의 모든 데이터가 팔로워 파티션에 복제된 상태이다.

<img width="530" alt="image" src="https://github.com/twoosky/TIL/assets/50009240/2e7c114c-838d-4f2f-a6e1-573b0ec45086">

> `ISR 중요한 이유`: Producer와 Consumer는 모두 리더 파티션과 통신한다. ISR 상태여야 리더 파티션에 장애가 발생해도 데이터 손실 없이 팔로워 파티션을 리더 파티션으로 승격해 사용할 수 있기 때문

## acks 옵션
* 카프카 프로듀서의 acks 옵션을 통해 프로듀서가 전송한 데이터를 카프카 클러스터에 얼마나 신뢰성 높게 저장할지 지정 가능
* 카프카 프로듀서의 acks 옵션은 0, 1, all(또는 -1) 값을 갖는다.
* 아래는 복제 개수가 2 이상인 경우에 acks 옵션 별 동작 방식이다. (복제 개수 2 = 리더 파티션 1, 팔로워 파티션 1)

<img width="830" alt="image" src="https://github.com/twoosky/TIL/assets/50009240/c687e3ad-0b5c-409b-9682-61748bb18f04">

**acks=0**
* 프로듀서가 리더 파티션으로 데이터를 전송했을 때 리더 파티션에 데이터가 정상적으로 저장되었는지 확인하지 않는다.
* *리더 파티션은 데이터가 저장된 이후 데이터가 몇 번째 오프셋에 저장되었는지 반환* 하는데, acks가 0인 경우 반환값을 확인하지 않는다.
* 파티션에 데이터가 정상 저장되었는지 확인하지 않기 때문에 데이터가 일부 유실될 수 있지만, 전송 속도가 빠르다.
* ex) GPS, 네비게이션과 같은 데이터 전송할 때 사용

**acks=1**
* 프로듀서는 보낸 데이터가 리더 파티션에만 정상적으로 저장되었는지 확인한다.
* 리더 파티션의 데이터 저장 신뢰성은 보장하지만, 팔로워 파티션의 데이터 저장 신뢰성은 보장하지 않는다.

**acks=-1(all)**
* 프로듀서는 보낸 데이터가 리더 파티션과 팔로워 파티션에 모두 정상적으로 저장되었는지 확인한다.
* 다른 옵션들에 비해 신뢰성은 높지만, 속도가 느리다.
* 토픽 단위로 설정 가능한 min.insync.replicas 옵션값에 따라 데이터의 안정성이 달라진다.
